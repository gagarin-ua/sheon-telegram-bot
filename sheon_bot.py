import logging
import os
import sys
import asyncio
from dotenv import load_dotenv
from telegram.ext import (
    Application,
    CommandHandler,
    CallbackQueryHandler,
    ContextTypes,
    MessageHandler,
    filters
)
from telegram import (
    InlineKeyboardButton,
    InlineKeyboardMarkup,
    Update
)

# ----------------------------------------------------
# --- –ù–ê–õ–ê–®–¢–£–í–ê–ù–ù–Ø –õ–û–ì–£–í–ê–ù–ù–Ø –¢–ê –ó–ú–Ü–ù–ù–ò–• –°–ï–†–ï–î–û–í–ò–©–ê ---
# ----------------------------------------------------

# –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑–º—ñ–Ω–Ω–∏—Ö —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ –∑ .env (–¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ)
load_dotenv()

# –û—Ç—Ä–∏–º–∞–Ω–Ω—è —Ç–æ–∫–µ–Ω–∞ —Ç–∞ URL
TOKEN = os.getenv("BOT_TOKEN")
# Render –Ω–∞–¥–∞—î –∑–æ–≤–Ω—ñ—à–Ω—ñ–π URL –≤ RENDER_EXTERNAL_URL
WEBHOOK_URL = os.getenv("WEBHOOK_URL") or os.getenv("RENDER_EXTERNAL_URL")
PORT = int(os.getenv("PORT", "8080")) # –ü–æ—Ä—Ç, —è–∫–∏–π –Ω–∞–¥–∞—î Render
WEBHOOK_PATH = f"/{TOKEN}" # –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ —Ç–æ–∫–µ–Ω —è–∫ —É–Ω—ñ–∫–∞–ª—å–Ω–∏–π —à–ª—è—Ö

# –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –±–∞–∑–æ–≤–æ–≥–æ –ª–æ–≥—É–≤–∞–Ω–Ω—è
logging.basicConfig(
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    level=logging.INFO
)
logger = logging.getLogger(__name__)

# ----------------------------------------------------
# --- –î–û–ü–û–ú–Ü–ñ–ù–Ü –§–£–ù–ö–¶–Ü–á –î–õ–Ø –ú–ï–ù–Æ ---
# ----------------------------------------------------

def get_main_menu_text():
    """–ü–æ–≤–µ—Ä—Ç–∞—î —Ç–µ–∫—Å—Ç –≥–æ–ª–æ–≤–Ω–æ–≥–æ –º–µ–Ω—é."""
    return (
        "–í–Ü–¢–ê–Ñ–ú–û\n\n"
        "–õ–∞—Å–∫–∞–≤–æ –ø—Ä–æ—Å–∏–º–æ —É —Å–≤—ñ—Ç –∞–≤—Ç–µ–Ω—Ç–∏—á–Ω–æ—ó –±—ñ–∂—É—Ç–µ—Ä—ñ—ó –∑ –Ω–∞—Ç—É—Ä–∞–ª—å–Ω–æ–≥–æ –∫–∞–º—ñ–Ω–Ω—è SHEON!‚ú®\n\n"
        "–ù–∞—à—ñ –≤–∏—Ä–æ–±–∏ —Å—Ç–≤–æ—Ä–µ–Ω—ñ –¥–ª—è –∂—ñ–Ω–æ–∫, —è–∫—ñ —Ü—ñ–Ω—É—é—Ç—å —É–Ω—ñ–∫–∞–ª—å–Ω—ñ—Å—Ç—å —Ç–∞ –≤–∏—Ç–æ–Ω—á–µ–Ω—ñ—Å—Ç—å.\n\n"
        "–¶–µ –Ω–µ –ø—Ä–æ—Å—Ç–æ –∞–∫—Å–µ—Å—É–∞—Ä–∏ ‚Äì —Ü–µ –¥–µ—Ç–∞–ª—ñ, —â–æ –ø—ñ–¥–∫—Ä–µ—Å–ª—é—é—Ç—å –≤–∞—à —Å—Ç–∏–ª—å —ñ –æ—Å–æ–±–∏—Å—Ç—ñ—Å—Ç—å, –∑–∞–ª–∏—à–∞—é—á–∏ –ª–µ–≥–∫–∏–π –∞–∫—Ü–µ–Ω—Ç –Ω–∞ –≤–∞—à—ñ–π –≤–ø–µ–≤–Ω–µ–Ω–æ—Å—Ç—ñ.\n\n"
        
        "–ë—É–¥—å—Ç–µ –ø–µ–≤–Ω—ñ: –∫–æ–∂–Ω–∞ –ø—Ä–∏–∫—Ä–∞—Å–∞ —ñ—Å–Ω—É—î –≤ —î–¥–∏–Ω–æ–º—É –µ–∫–∑–µ–º–ø–ª—è—Ä—ñ —ñ —Å—Ç–≤–æ—Ä–µ–Ω–∞ —Å–∞–º–µ –¥–ª—è –≤–∞—Å.\n‚≠ê –ú–∏ –º–æ–∂–µ–º–æ –≤—ñ–¥—Ç–≤–æ—Ä–∏—Ç–∏ –Ω–∞—Å—Ç—Ä—ñ–π, –ø–∞–ª—ñ—Ç—Ä—É —Ç–∞ –º–∞—Ç–µ—Ä—ñ–∞–ª–∏ –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–≥–æ –≤–∏—Ä–æ–±—É, –∞–ª–µ —Ç–æ—á–Ω–∏–π –ø–æ–≤—Ç–æ—Ä –Ω–µ–º–æ–∂–ª–∏–≤–∏–π. –ö–æ–∂–Ω–µ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è - —É–Ω—ñ–∫–∞–ª—å–Ω–∞ –∫–æ–º–ø–æ–∑–∏—Ü—ñ—è.\n‚≠ê SHEON –Ω–µ –≥–∞—Ä–∞–Ω—Ç—É—î –≤—ñ–¥—Å—É—Ç–Ω–æ—Å—Ç—ñ —Å—Ö–æ–∂–∏—Ö –≤–∏—Ä–æ–±—ñ–≤ —Ç—Ä–µ—Ç—ñ—Ö –æ—Å—ñ–± —ñ –Ω–µ –Ω–µ—Å–µ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω–æ—Å—Ç—ñ –∑–∞ –¥—ñ—ó/–ø—Ä–æ–¥—É–∫—Ü—ñ—é —ñ–Ω—à–∏—Ö –≤–∏—Ä–æ–±–Ω–∏–∫—ñ–≤."
    )

def get_main_menu_keyboard():
    """–ü–æ–≤–µ—Ä—Ç–∞—î –∫–ª–∞–≤—ñ–∞—Ç—É—Ä—É –≥–æ–ª–æ–≤–Ω–æ–≥–æ –º–µ–Ω—é."""
    keyboard = [
        # [InlineKeyboardButton("üéÅ –ö–∞—Ç–∞–ª–æ–≥ —ñ —Ü—ñ–Ω–∏", url="https://t.me/your_channel_link")],
        [InlineKeyboardButton("üìú –Ü–°–¢–û–†–Ü–Ø –ö–ê–ú–Ü–ù–ù–Ø", callback_data='stones_menu')],
        [InlineKeyboardButton("üí° –ü–æ—Ä–∞–¥–∞ –≤—ñ–¥ –Ω–∞—Å", callback_data='advice')],
        [InlineKeyboardButton("‚è±Ô∏è –ì—Ä–∞—Ñ—ñ–∫ —Ä–æ–±–æ—Ç–∏", callback_data='schedule')],
        [InlineKeyboardButton("üì¶ –î–æ—Å—Ç–∞–≤–∫–∞ –π –æ–ø–ª–∞—Ç–∞", callback_data='delivery')],
        [InlineKeyboardButton("üìù –ü–∞–º'—è—Ç–∫–∞ –ø–æ –¥–æ–≥–ª—è–¥—É", callback_data='care_memo')],
        [InlineKeyboardButton("üí¨ –ó–≤'—è–∑–æ–∫ –∑ –º–∞–π—Å—Ç—Ä–æ–º", callback_data='contact')]
    ]
    return InlineKeyboardMarkup(keyboard)

# ----------------------------------------------------
# --- –õ–û–ì–Ü–ö–ê –î–õ–Ø –ö–ê–ú–ï–ù–Ü–í ---
# ----------------------------------------------------
STONE_DATA = {
    'stone_aquamarine': ("üíß **–ê–ö–í–ê–ú–ê–†–ò–ù**\n\n**–í–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—ñ:**\n –ö–∞–º—ñ–Ω—å –≥–∞—Ä–º–æ–Ω—ñ—ó —Ç–∞ —è—Å–Ω–æ—Å—Ç—ñ –¥—É–º–æ–∫.\n –ü—ñ–¥–∫—Ä–µ—Å–ª—é—î —Å–ø–æ–∫—ñ–π —ñ –≤–Ω—É—Ç—Ä—ñ—à–Ω—é —Å–∏–ª—É.\n\n**–°—Ç–∏–ª—å:** –î—ñ–ª–æ–≤–∏–π —ñ –ª–µ–≥–∫–∏–π casual."),
    'stone_amethist': ("üíú **–ê–ú–ï–¢–ò–°–¢**\n\n**–í–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—ñ:**\n –ö–∞–º—ñ–Ω—å —Å–ø–æ–∫–æ—é —Ç–∞ –≥–∞—Ä–º–æ–Ω—ñ—ó.\n –î–ª—è —Ç–∏—Ö, —Ö—Ç–æ —Ü—ñ–Ω—É—î –≤–∏—Ç–æ–Ω—á–µ–Ω—ñ—Å—Ç—å —ñ –≤–Ω—É—Ç—Ä—ñ—à–Ω—ñ–π –±–∞–ª–∞–Ω—Å.\n\n**–°—Ç–∏–ª—å:** –°–µ—Ä–µ–∂–∫–∏, –∫–∞–±–ª—É—á–∫–∏."),
    'stone_turquoise': ("üü¶ **–ë–Ü–†–Æ–ó–ê**\n\n**–í–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—ñ:**\n –ö–∞–º—ñ–Ω—å –∑–∞—Ö–∏—Å—Ç—É —Ç–∞ –≤–Ω—É—Ç—Ä—ñ—à–Ω—å–æ–≥–æ —Å–ø–æ–∫–æ—é.\n –ü—ñ–¥–∫—Ä–µ—Å–ª—é—î —ñ–Ω–¥–∏–≤—ñ–¥—É–∞–ª—å–Ω—ñ—Å—Ç—å —ñ –ª–µ–≥–∫—ñ—Å—Ç—å —Å—Ç–∏–ª—é.\n\n**–°—Ç–∏–ª—å:** –©–æ–¥–µ–Ω–Ω—ñ —Ç–∞ –µ—Ç–Ω—ñ—á–Ω—ñ –æ–±—Ä–∞–∑–∏."),
    'stone_garnet': ("üß° **–ì–†–ê–ù–ê–¢**\n\n**–í–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—ñ:**\n –°–∏–º–≤–æ–ª –∂–∏—Ç—Ç—î–≤–æ—ó –µ–Ω–µ—Ä–≥—ñ—ó —Ç–∞ –≤–ø–µ–≤–Ω–µ–Ω–æ—Å—Ç—ñ.\n –ü—ñ–¥–∫—Ä–µ—Å–ª—é—î —Ö–∞—Ä–∞–∫—Ç–µ—Ä —ñ —Ä—ñ—à—É—á—ñ—Å—Ç—å.\n\n**–°—Ç–∏–ª—å:** –î–ª—è –∞–∫—Ü–µ–Ω—Ç–Ω–∏—Ö –æ–±—Ä–∞–∑—ñ–≤."),
    'stone_labradorite': ("‚ú® **–õ–ê–ë–†–ê–î–û–†–ò–¢**\n\n**–í–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—ñ:**\n –ö–∞–º—ñ–Ω—å –Ω–∞—Ç—Ö–Ω–µ–Ω–Ω—è —Ç–∞ —Ç–≤–æ—Ä—á–æ—Å—Ç—ñ.\n –ü—ñ–¥–∫—Ä–µ—Å–ª—é—î —ñ–Ω–¥–∏–≤—ñ–¥—É–∞–ª—å–Ω—ñ—Å—Ç—å —ñ –ª–µ–≥–∫—É –∑–∞–≥–∞–¥–∫–æ–≤—ñ—Å—Ç—å.\n\n**–°—Ç–∏–ª—å:** –ê–∫—Ü–µ–Ω—Ç–Ω—ñ –±—Ä–∞—Å–ª–µ—Ç–∏ —Ç–∞ –∫–æ–ª—å—î."),
    'stone_onyx': ("‚ö´ **–û–ù–Ü–ö–°**\n\n**–í–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—ñ:**\n –°–∏–º–≤–æ–ª –≤–ø–µ–≤–Ω–µ–Ω–æ—Å—Ç—ñ —Ç–∞ –≤–Ω—É—Ç—Ä—ñ—à–Ω—å–æ—ó —Å–∏–ª–∏.\n –î–æ–ø–æ–º–∞–≥–∞—î —Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ –æ–±—Ä–∞–∑–∏ —Ü—ñ–ª—ñ—Å–Ω–æ—Å—Ç—ñ —Ç–∞ —Ä—ñ—à—É—á–æ—Å—Ç—ñ.\n\n**–°—Ç–∏–ª—å:** –ö–ª–∞—Å–∏–∫–∞, –º—ñ–Ω—ñ–º–∞–ª—ñ–∑–º."),
    'stone_pearls': ("‚ö™ **–ü–ï–†–õ–ò**\n\n**–í–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—ñ:**\n –°–∏–º–≤–æ–ª —á–∏—Å—Ç–æ—Ç–∏ —Ç–∞ –≤–∏—Ç–æ–Ω—á–µ–Ω–æ—Å—Ç—ñ.\n –î–æ–¥–∞—î –µ–ª–µ–≥–∞–Ω—Ç–Ω–æ—Å—Ç—ñ —Ç–∞ –º‚Äô—è–∫–æ—Å—Ç—ñ –æ–±—Ä–∞–∑—É.\n\n**–°—Ç–∏–ª—å:** –ö–ª–∞—Å–∏—á–Ω—ñ —ñ –≤–µ—á—ñ—Ä–Ω—ñ –ø—Ä–∏–∫—Ä–∞—Å–∏."),
    'stone_rose_quartz': ("üíó **–†–û–ñ–ï–í–ò–ô –ö–í–ê–†–¶**\n\n**–í–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—ñ:**\n –°–∏–º–≤–æ–ª –Ω—ñ–∂–Ω–æ—Å—Ç—ñ, –∂—ñ–Ω–æ—á–Ω–æ—Å—Ç—ñ —Ç–∞ –≥–∞—Ä–º–æ–Ω—ñ—ó.\n –ü—ñ–¥–∫—Ä–µ—Å–ª—é—î –µ–ª–µ–≥–∞–Ω—Ç–Ω—ñ—Å—Ç—å —ñ –º‚Äô—è–∫—ñ—Å—Ç—å –æ–±—Ä–∞–∑—É.\n\n**–°—Ç–∏–ª—å:** –î—ñ–ª–æ–≤–∏–π —ñ –≤–µ—á—ñ—Ä–Ω—ñ–π."),
    'stone_emerald': ("üíö **–°–ú–ê–†–ê–ì–î**\n\n**–í–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—ñ:**\n –ö–∞–º—ñ–Ω—å —Å–∏–ª–∏, —Ä–æ—Å—Ç—É —Ç–∞ –≥–∞—Ä–º–æ–Ω—ñ—ó.\n –î–æ–¥–∞—î –≤–∏—à—É–∫–∞–Ω–æ—Å—Ç—ñ —Ç–∞ –∞—Ä–∏—Å—Ç–æ–∫—Ä–∞—Ç–∏—á–Ω–æ—Å—Ç—ñ.\n\n**–°—Ç–∏–ª—å:** –ö–ª–∞—Å–∏–∫–∞ —Ç–∞ –ø—Ä–µ–º—ñ–∞–ª—å–Ω—ñ –∞–∫—Å–µ—Å—É–∞—Ä–∏."),
    'stone_topaz': ("üíô **–¢–û–ü–ê–ó**\n\n**–í–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—ñ:**\n –°–∏–º–≤–æ–ª —è—Å–Ω–æ—Å—Ç—ñ —Ç–∞ –≤–Ω—É—Ç—Ä—ñ—à–Ω—å–æ–≥–æ —Å–≤—ñ—Ç–ª–∞.\n –ü—ñ–¥–∫—Ä–µ—Å–ª—é—î —á–∏—Å—Ç–æ—Ç—É —ñ –ª–µ–≥–∫—ñ—Å—Ç—å –æ–±—Ä–∞–∑—É.\n\n**–°—Ç–∏–ª—å:** –ï–ª–µ–≥–∞–Ω—Ç–Ω—ñ –ø—Ä–∏–∫—Ä–∞—Å–∏ –Ω–∞ –≤–µ—á—ñ—Ä."),
    'stone_tourmaline': ("üî¥ **–¢–£–†–ú–ê–õ–Ü–ù**\n\n**–í–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—ñ:**\n –°–∏–º–≤–æ–ª –∑–∞—Ö–∏—Å—Ç—É —Ç–∞ –µ–Ω–µ—Ä–≥—ñ—ó.\n –ü—ñ–¥–∫—Ä–µ—Å–ª—é—î —Å–∏–ª—É —Ç–∞ –≤–∏—Ç–æ–Ω—á–µ–Ω—ñ—Å—Ç—å.\n\n**–°—Ç–∏–ª—å:** –©–æ–¥–µ–Ω–Ω—ñ —ñ –∞–∫—Ü–µ–Ω—Ç–Ω—ñ –ø—Ä–∏–∫—Ä–∞—Å–∏."),
    'stone_citrine': ("üíõ **–¶–ò–¢–†–ò–ù**\n\n**–í–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—ñ:**\n –ö–∞–º—ñ–Ω—å –µ–Ω–µ—Ä–≥—ñ—ó —Ç–∞ –≤–ø–µ–≤–Ω–µ–Ω–æ—Å—Ç—ñ.\n –î–æ–¥–∞—î —è—Å–∫—Ä–∞–≤–æ—Å—Ç—ñ —Ç–∞ –ª–µ–≥–∫–æ–≥–æ –∞–∫—Ü–µ–Ω—Ç—É.\n\n**–°—Ç–∏–ª—å:** –©–æ–¥–µ–Ω–Ω–µ –Ω–æ—Å—ñ–Ω–Ω—è."),
}
# ----------------------------------------------------
# --- –û–ë–†–û–ë–ù–ò–ö–ò –ö–û–ú–ê–ù–î –Ü –ö–ù–û–ü–û–ö ---
# ----------------------------------------------------

async def start_command(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """–û–±—Ä–æ–±–ª—è—î –∫–æ–º–∞–Ω–¥—É /start, –Ω–∞–¥—Å–∏–ª–∞—é—á–∏ –≥–æ–ª–æ–≤–Ω–µ –º–µ–Ω—é."""
    welcome_text = get_main_menu_text()
    reply_markup = get_main_menu_keyboard()
    await update.message.reply_text(welcome_text, reply_markup=reply_markup, parse_mode='Markdown')

async def help_command(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """–û–±—Ä–æ–±–ª—è—î –∫–æ–º–∞–Ω–¥—É /help."""
    await update.message.reply_text(
        "–Ø –±–æ—Ç –º–∞–≥–∞–∑–∏–Ω—É SHEON. –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å /start, —â–æ–± –≤—ñ–¥–∫—Ä–∏—Ç–∏ –≥–æ–ª–æ–≤–Ω–µ –º–µ–Ω—é –∑ –∫–∞—Ç–∞–ª–æ–≥–æ–º —Ç–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—î—é."
    )
    
async def unknown_message(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """–û–±—Ä–æ–±–ª—è—î –±—É–¥—å-—è–∫–µ —Ç–µ–∫—Å—Ç–æ–≤–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è, —è–∫–µ –Ω–µ —î –∫–æ–º–∞–Ω–¥–æ—é –∞–±–æ callback'–æ–º."""
    await update.message.reply_text(
        "–í–∏–±–∞—á—Ç–µ, —è —Ä–æ–∑—É–º—ñ—é –ª–∏—à–µ –∫–æ–º–∞–Ω–¥–∏ (/start) –∞–±–æ –∫–Ω–æ–ø–∫–∏ –º–µ–Ω—é. –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å /start, —â–æ–± –ø–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—è –¥–æ –≥–æ–ª–æ–≤–Ω–æ–≥–æ –º–µ–Ω—é."
    )

async def button_handler(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """–û–±—Ä–æ–±–ª—è—î –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—è –Ω–∞ —ñ–Ω–ª–∞–π–Ω-–∫–Ω–æ–ø–∫–∏ (callback query)."""
    query = update.callback_query
    await query.answer()

    # –°—Ç–≤–æ—Ä—é—î–º–æ –∫–Ω–æ–ø–∫–∏ –¥–ª—è –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è
    back_to_stones_button = [[InlineKeyboardButton("‚¨ÖÔ∏è –ù–∞–∑–∞–¥ –¥–æ –°–ø–∏—Å–∫—É –ö–∞–º—ñ–Ω–Ω—è", callback_data='stones_menu')]]
    back_to_menu_button = [[InlineKeyboardButton("‚¨ÖÔ∏è –ü–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—è –¥–æ –ú–µ–Ω—é", callback_data='menu_back')]]
    
    # --- –û–±—Ä–æ–±–∫–∞ –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è –¥–æ –≥–æ–ª–æ–≤–Ω–æ–≥–æ –º–µ–Ω—é ---
    if query.data == 'menu_back':
        welcome_text = get_main_menu_text()
        reply_markup = get_main_menu_keyboard()
        await query.edit_message_text(text=welcome_text, reply_markup=reply_markup, parse_mode='Markdown')

    # --- –û–±—Ä–æ–±–∫–∞ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—è –Ω–∞ –∫–Ω–æ–ø–∫—É "üìú –Ü–°–¢–û–†–Ü–Ø –ö–ê–ú–Ü–ù–ù–Ø" (–ø—ñ–¥–º–µ–Ω—é) ---
    elif query.data == 'stones_menu':
        stones_intro_text = (
            "üíé –û–ë–ï–†–Ü–¢–¨ –°–í–Ü–ô –ö–ê–ú–Ü–ù–¨\n\n"
            "–ö–æ–∂–Ω–µ –∫–∞–º—ñ–Ω–Ω—è –º–∞—î –≤–ª–∞—Å–Ω—É —ñ—Å—Ç–æ—Ä—ñ—é, —Ö–∞—Ä–∞–∫—Ç–µ—Ä —Ç–∞ –Ω–µ–ø–æ–≤—Ç–æ—Ä–Ω—É –∫—Ä–∞—Å—É.\n\n"
            "–ú–∏ –ø—ñ–¥–±–∏—Ä–∞—î–º–æ —Ç—ñ–ª—å–∫–∏ –Ω–∞—Ç—É—Ä–∞–ª—å–Ω–µ –∫–∞–º—ñ–Ω–Ω—è, —â–æ–± –∫–æ–∂–µ–Ω –≤–∏—Ä—ñ–± –±—É–≤ —É–Ω—ñ–∫–∞–ª—å–Ω–∏–º...\n\n"
            "–û–±–µ—Ä—ñ—Ç—å –∫–∞–º—ñ–Ω—å, —â–æ–± –ø—Ä–æ—á–∏—Ç–∞—Ç–∏ –π–æ–≥–æ —ñ—Å—Ç–æ—Ä—ñ—é:"
        )
        # –ö–ª–∞–≤—ñ–∞—Ç—É—Ä–∞ –¥–ª—è –∫–∞–º–µ–Ω—ñ–≤ (–ø–æ–≤–Ω–∏–π —Å–ø–∏—Å–æ–∫)
        stones_keyboard = [
            [InlineKeyboardButton("üíß –ê–∫–≤–∞–º–∞—Ä–∏–Ω", callback_data='stone_aquamarine')],
            [InlineKeyboardButton("üíú –ê–º–µ—Ç–∏—Å—Ç", callback_data='stone_amethist')],
            [InlineKeyboardButton("üü¶ –ë—ñ—Ä—é–∑–∞", callback_data='stone_turquoise')],
            [InlineKeyboardButton("üß° –ì—Ä–∞–Ω–∞—Ç", callback_data='stone_garnet')],
            [InlineKeyboardButton("‚ú® –õ–∞–±—Ä–∞–¥–æ—Ä–∏—Ç", callback_data='stone_labradorite')],
            [InlineKeyboardButton("‚ö´ –û–Ω—ñ–∫—Å", callback_data='stone_onyx')],
            [InlineKeyboardButton("‚ö™ –ü–µ—Ä–ª–∏", callback_data='stone_pearls')],
            [InlineKeyboardButton("üíó –†–æ–∂–µ–≤–∏–π –∫–≤–∞—Ä—Ü", callback_data='stone_rose_quartz')],
            [InlineKeyboardButton("üíö –°–º–∞—Ä–∞–≥–¥", callback_data='stone_emerald')],
            [InlineKeyboardButton("üíô –¢–æ–ø–∞–∑", callback_data='stone_topaz')],
            [InlineKeyboardButton("üî¥ –¢—É—Ä–º–∞–ª—ñ–Ω", callback_data='stone_tourmaline')],
            [InlineKeyboardButton("üíõ –¶–∏—Ç—Ä–∏–Ω", callback_data='stone_citrine')],
            back_to_menu_button[0] # –ö–Ω–æ–ø–∫–∞ –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è –¥–æ –ú–µ–Ω—é
        ]
        reply_markup = InlineKeyboardMarkup(stones_keyboard)
        await query.edit_message_text(text=stones_intro_text, reply_markup=reply_markup, parse_mode='Markdown')

    # --- –õ–û–ì–Ü–ö–ê –î–õ–Ø –ö–û–ñ–ù–û–ì–û –ö–ê–ú–ï–ù–Ø (–≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ —Å–ª–æ–≤–Ω–∏–∫ STONE_DATA) ---
    elif query.data in STONE_DATA:
        await query.edit_message_text(
            text=STONE_DATA[query.data], 
            reply_markup=InlineKeyboardMarkup(back_to_stones_button), 
            parse_mode='Markdown'
        )

    # --- –û–±—Ä–æ–±–∫–∞ –∫–Ω–æ–ø–∫–∏ "üí° –ü–æ—Ä–∞–¥–∞ –≤—ñ–¥ –Ω–∞—Å" ---
    elif query.data == 'advice':
        advice_text = (
            "üí° **–ü–û–†–ê–î–ê –í–Ü–î –ù–ê–°**\n\n"
            "–ù–æ—Å—ñ—Ç—å –∫–∞–º—ñ–Ω–Ω—è —Ç–∞–∫, —â–æ–± –≤–æ–Ω–æ –ø—ñ–¥–∫—Ä–µ—Å–ª—é–≤–∞–ª–æ –≤–∞—à —Ö–∞—Ä–∞–∫—Ç–µ—Ä, –∞ –Ω–µ —Ç—ñ–ª—å–∫–∏ –∫–æ–ª—ñ—Ä –∞–±–æ —Ç—Ä–µ–Ω–¥.\n\n"
            "–ö–æ–∂–µ–Ω –≤–∏—Ä—ñ–± —ñ—Å–Ω—É—î **–≤ —î–¥–∏–Ω–æ–º—É –µ–∫–∑–µ–º–ø–ª—è—Ä—ñ**, —Ç–æ–º—É —Ü–µ –Ω–µ –ø—Ä–æ—Å—Ç–æ –ø—Ä–∏–∫—Ä–∞—Å–∞, –∞ –º–∞–ª–µ–Ω—å–∫–∞ –¥–µ—Ç–∞–ª—å –≤–∞—à–æ—ó —ñ–Ω–¥–∏–≤—ñ–¥—É–∞–ª—å–Ω–æ—Å—Ç—ñ."
        )
        await query.edit_message_text(text=advice_text, reply_markup=InlineKeyboardMarkup(back_to_menu_button), parse_mode='Markdown')

    # --- –û–±—Ä–æ–±–∫–∞ –∫–Ω–æ–ø–∫–∏ "‚è±Ô∏è –ì—Ä–∞—Ñ—ñ–∫ —Ä–æ–±–æ—Ç–∏" ---
    elif query.data == 'schedule':
        schedule_text = (
            "‚è±Ô∏è **–ì–†–ê–§–Ü–ö –†–û–ë–û–¢–ò**\n\n"
            "–í—ñ–¥–ø–æ–≤—ñ–¥–∞—î–º–æ –Ω–∞ –≤–∞—à—ñ –∑–≤–µ—Ä–Ω–µ–Ω–Ω—è —â–æ–¥–Ω—è **–∑ 10:00 –¥–æ 20:00** –≤ –ø–æ—Ä—è–¥–∫—É —á–µ—Ä–≥–∏."
        )
        await query.edit_message_text(text=schedule_text, reply_markup=InlineKeyboardMarkup(back_to_menu_button), parse_mode='Markdown')

    # --- –û–±—Ä–æ–±–∫–∞ –∫–Ω–æ–ø–∫–∏ "üì¶ –î–æ—Å—Ç–∞–≤–∫–∞ –π –æ–ø–ª–∞—Ç–∞" ---
    elif query.data == 'delivery':
        delivery_text = (
            "üì¶ **–î–û–°–¢–ê–í–ö–ê –ô –û–ü–õ–ê–¢–ê**\n\n"
            "–î–æ—Å—Ç–∞–≤–∫–∞ –∑–¥—ñ–π—Å–Ω—é—î—Ç—å—Å—è —É –≤—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è –ù–æ–≤–æ—ó –ø–æ—à—Ç–∏ –∑–∞ '–ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ—é 100% –æ–ø–ª–∞—Ç–æ—é'."
        )
        await query.edit_message_text(text=delivery_text, reply_markup=InlineKeyboardMarkup(back_to_menu_button), parse_mode='Markdown')

    # --- –û–±—Ä–æ–±–∫–∞ –∫–Ω–æ–ø–∫–∏ "üìù –ü–∞–º'—è—Ç–∫–∞ –ø–æ –¥–æ–≥–ª—è–¥—É" (–°—Ç–≤–æ—Ä–µ–Ω–Ω—è –ü–Ü–î–ú–ï–ù–Æ) ---
    elif query.data == 'care_memo':
        care_memo_intro_text = (
            "üìù **–ü–ê–ú'–Ø–¢–ö–ê –ü–û –î–û–ì–õ–Ø–î–£**\n\n"
            "–û–±–µ—Ä—ñ—Ç—å —Ä–æ–∑–¥—ñ–ª, –ø—Ä–æ —è–∫–∏–π –≤–∏ —Ö–æ—á–µ—Ç–µ –¥—ñ–∑–Ω–∞—Ç–∏—Å—è –¥–µ—Ç–∞–ª—å–Ω—ñ—à–µ:"
        )
        care_memo_keyboard = [
            [InlineKeyboardButton("1. –ü–æ–≤—Å—è–∫–¥–µ–Ω–Ω–µ –∫–æ—Ä–∏—Å—Ç—É–≤–∞–Ω–Ω—è", callback_data='care_memo_part1')],
            [InlineKeyboardButton("2. –ó–±–µ—Ä—ñ–≥–∞–Ω–Ω—è —Ç–∞ –î–æ–≥–ª—è–¥", callback_data='care_memo_part2')],
            back_to_menu_button[0]
        ]
        reply_markup = InlineKeyboardMarkup(care_memo_keyboard)
        await query.edit_message_text(text=care_memo_intro_text, reply_markup=reply_markup, parse_mode='Markdown')
    
    # 4–∞. –û–±—Ä–æ–±–∫–∞ –∫–Ω–æ–ø–∫–∏ "1. –ü–æ–≤—Å—è–∫–¥–µ–Ω–Ω—è —Ç–∞ –§—É—Ä–Ω—ñ—Ç—É—Ä–∞"
    elif query.data == 'care_memo_part1':
        part1_text = (
            "1 –ü–û–í–°–Ø–ö–î–ï–ù–ù–ï –ö–û–†–ò–°–¢–£–í–ê–ù–ù–Ø\n\n"
            "–ü—Ä–∞–≤–∏–ª–æ –æ—Å—Ç–∞–Ω–Ω—å–æ–≥–æ —à—Ç—Ä–∏—Ö–∞: –∫–æ—Å–º–µ—Ç–∏–∫–∞/–ø–∞—Ä—Ñ—É–º ‚Üí –ø–æ—Ç—ñ–º –ø—Ä–∏–∫—Ä–∞—Å–∏.\n\n"
            "–ó–Ω—ñ–º–∞—Ç–∏ –ø–µ—Ä–µ–¥:\n"
            "- –°–ø–æ—Ä—Ç–æ–º, —Å–Ω–æ–º, –¥—É—à–µ–º/–≤–∞–Ω–Ω–æ—é, –±–∞—Å–µ–π–Ω–æ–º/–º–æ—Ä–µ–º, —Å–∞—É–Ω–æ—é/—Å–æ–ª—è—Ä—ñ—î–º.\n"
            "- –ü—Ä–∏–±–∏—Ä–∞–Ω–Ω—è–º —ñ —Ä–æ–±–æ—Ç–æ—é –∑ —Ö—ñ–º—ñ—î—é.\n\n"
            "–ü—ñ—Å–ª—è –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –ø—Ä–æ—Ç–∏—Ä–∞–π—Ç–µ –º‚Äô—è–∫–æ—é —Å—É—Ö–æ—é –º—ñ–∫—Ä–æ—Ñ—ñ–±—Ä–æ—é.\n\n"
            "–§—É—Ä–Ω—ñ—Ç—É—Ä–∞ –∫–ª–∞—Å—É –ª—é–∫—Å.\n"
            "–ú–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ —è–∫—ñ—Å–Ω—É —Ñ—É—Ä–Ω—ñ—Ç—É—Ä—É (–ü–æ–∑–æ–ª–æ—Ç–∞ 18K/PVD, –ø—Ä–µ–º—ñ—É–º‚Äë—Å—Ç–∞–ª—å 304/316L). –í–æ–Ω–∞ –Ω–µ –ª—é–±–∏—Ç—å —Ç—Ä–∏–≤–∞–ª–∏–π –ø—Ä—è–º–∏–π –∫–æ–Ω—Ç–∞–∫—Ç —ñ–∑ –≤–æ–¥–æ—é, –ø–æ—Ç–æ–º, –ø–∞—Ä—Ñ—É–º–∞–º–∏, —Ö–ª–æ—Ä–æ–º —ñ —Å–æ–ª–æ–Ω–æ—é –≤–æ–¥–æ—é. –ü–µ—Ä–µ–¥ —Ç—Ä–µ–Ω—É–≤–∞–Ω–Ω—è–º —ñ –≤–æ–¥–Ω–∏–º–∏ –ø—Ä–æ—Ü–µ–¥—É—Ä–∞–º–∏ ‚Äî –∑–Ω—ñ–º–∞–π—Ç–µ. –ü—ñ—Å–ª—è –≤–æ–ª–æ–≥–∏ ‚Äî –≤—ñ–¥—Ä–∞–∑—É –≤–∏—Ç—Ä—ñ—Ç—å –Ω–∞—Å—É—Ö–æ."
        )
        back_button = [[InlineKeyboardButton("‚¨ÖÔ∏è –ù–∞–∑–∞–¥ –¥–æ –ü–∞–º'—è—Ç–∫–∏", callback_data='care_memo')]]
        await query.edit_message_text(text=part1_text, reply_markup=InlineKeyboardMarkup(back_button), parse_mode='Markdown')
        
    # 4–±. –û–±—Ä–æ–±–∫–∞ –∫–Ω–æ–ø–∫–∏ "2. –ó–±–µ—Ä—ñ–≥–∞–Ω–Ω—è —Ç–∞ –î–æ–≥–ª—è–¥ –∑–∞ –ö–∞–º—ñ–Ω–Ω—è–º"
    elif query.data == 'care_memo_part2':
        part2_text = (
            "2. –ó–ë–ï–†–Ü–ì–ê–ù–ù–Ø –¢–ê –î–û–ì–õ–Ø–î\n\n"
            "–ó–±–µ—Ä—ñ–≥–∞–π—Ç–µ –ø—Ä–∏–∫—Ä–∞—Å–∏ –æ–∫—Ä–µ–º–æ:\n"
            "- –£ –º‚Äô—è–∫–∏—Ö –º—ñ—à–µ—á–∫–∞—Ö –∞–±–æ —Å–∫—Ä–∏–Ω—å–∫–∞—Ö —ñ–∑ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∞–º–∏, —â–æ–± —É–Ω–∏–∫–Ω—É—Ç–∏ –ø–æ–¥—Ä—è–ø–∏–Ω.\n"
            "- –£–Ω–∏–∫–∞–π—Ç–µ –ø—Ä—è–º–æ–≥–æ —Å–æ–Ω—Ü—è, –Ω–∞–¥–º—ñ—Ä–Ω–æ—ó –≤–æ–ª–æ–≥–æ—Å—Ç—ñ –∞–±–æ –ø–µ—Ä–µ—Å—É—à–µ–Ω–æ–≥–æ –ø–æ–≤—ñ—Ç—Ä—è.\n\n"
            "–î–æ–≥–ª—è–¥ –∑–∞ –∫–∞–º—ñ–Ω–Ω—è–º:\n"
            "- –ö–≤–∞—Ä—Ü, –∞–≥–∞—Ç, –æ–Ω—ñ–∫—Å, —è—à–º–∞, –∞–≤–∞–Ω—Ç—é—Ä–∏–Ω: —Ç–µ–ø–ª–∞ –≤–æ–¥–∞ + –∫—Ä–∞–ø–ª—è –Ω–µ–π—Ç—Ä–∞–ª—å–Ω–æ–≥–æ –º–∏–ª–∞, –∫–æ—Ä–æ—Ç–∫–æ, –±–µ–∑ –∑–∞–º–æ—á—É–≤–∞–Ω—å - –æ–ø–æ–ª–æ—Å–Ω—É—Ç–∏ - –Ω–∞—Å—É—Ö–æ.\n"
            "- –ú—ñ—Å—è—á–Ω–∏–π –∫–∞–º—ñ–Ω—å, –ª–∞–±—Ä–∞–¥–æ—Ä–∏—Ç: —à–≤–∏–¥–∫–µ –æ–ø–æ–ª—ñ—Å–∫—É–≤–∞–Ω–Ω—è, –±–µ–∑ –ø–µ—Ä–µ–ø–∞–¥—ñ–≤ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä.\n"
            "- –ú–∞–ª–∞—Ö—ñ—Ç, –±—ñ—Ä—é–∑–∞, –ª–∞–∑—É—Ä–∏—Ç, –∫–æ—Ä–∞–ª, –æ–ø–∞–ª, –ø–µ—Ä–ª–∏: –ª–∏—à–µ –∑–ª–µ–≥–∫–∞ –≤–æ–ª–æ–≥–∞ –º‚Äô—è–∫–∞ —Å–µ—Ä–≤–µ—Ç–∫–∞, –±–µ–∑ —Ö—ñ–º—ñ—ó - —à–≤–∏–¥–∫–æ –≤–∏—Å—É—à–∏—Ç–∏.\n"
            "- –ü–æ–∑–æ–ª–æ—Ç–∞: —Ç—ñ–ª—å–∫–∏ —Å—É—Ö–∞ –º—ñ–∫—Ä–æ—Ñ—ñ–±—Ä–∞ (–±–µ–∑ –ø–∞—Å—Ç —ñ –ø–æ–ª—ñ—Ä—É–≤–∞–Ω—å).\n"
            "- –°—Ç–∞–ª—å 304/316L: –ø—Ä–æ—Ç–µ—Ä—Ç–∏ –Ω–∞—Å—É—Ö–æ –ø—ñ—Å–ª—è –≤–æ–¥–∏.\n\n"
            "–ù–∞—à—ñ –ø—Ä–∏–∫—Ä–∞—Å–∏ –Ω–µ –ª—é–±–ª—è—Ç—å: –°–ø–∏—Ä—Ç, –∞—Ü–µ—Ç–æ–Ω, –æ—Ü–µ—Ç, –∞–º—ñ–∞–∫, —Ö–ª–æ—Ä, –∞–±—Ä–∞–∑–∏–≤–∏, —É–ª—å—Ç—Ä–∞–∑–≤—É–∫ —Ç–∞ –ø–∞—Ä, —Ä—ñ–∑–∫—ñ —É–¥–∞—Ä–∏, —Ä—ñ–∑–∫—ñ –ø–µ—Ä–µ–ø–∞–¥–∏ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä."
        )
        back_button = [[InlineKeyboardButton("‚¨ÖÔ∏è –ù–∞–∑–∞–¥ –¥–æ –ü–∞–º'—è—Ç–∫–∏", callback_data='care_memo')]]
        await query.edit_message_text(text=part2_text, reply_markup=InlineKeyboardMarkup(back_button), parse_mode='Markdown')
        
    # 5. –û–±—Ä–æ–±–∫–∞ –∫–Ω–æ–ø–∫–∏ "üí¨ –ó–≤'—è–∑–æ–∫ –∑ –º–∞–π—Å—Ç—Ä–æ–º"
    elif query.data == 'contact':
        contact_text = (
            "üí¨ **–ó–í'–Ø–ó–û–ö –ó –ú–ê–ô–°–¢–†–û–ú**\n\n"
            "–©–æ–¥–Ω—è **–∑ 10:00 –¥–æ 20:00**\n"
            "–©–æ–± –∑—Ä–æ–±–∏—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è, —É—Ç–æ—á–Ω–∏—Ç–∏ –¥–µ—Ç–∞–ª—ñ –∞–±–æ –ø–æ—Å—Ç–∞–≤–∏—Ç–∏ –∑–∞–ø–∏—Ç–∞–Ω–Ω—è, –Ω–∞–ø–∏—à—ñ—Ç—å –Ω–∞–º:\n\n"
            "‚ú® *–ú–∞–π—Å—Ç–µ—Ä –≤—ñ–¥–ø–æ–≤—ñ—Å—Ç—å –ø—Ä–æ—Ç—è–≥–æ–º –∫—ñ–ª—å–∫–æ—Ö –≥–æ–¥–∏–Ω.*\n"
            "‚ú® *–ê–±–æ –Ω–∞–ø–∏—à—ñ—Ç—å –Ω–∞–º —É —Å–æ—Ü–º–µ—Ä–µ–∂–∞—Ö –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –∫–Ω–æ–ø–æ–∫ –Ω–∏–∂—á–µ.*"
        )
        INSTAGRAM_LINK = "https://instagram.com/sheon_jewelry"
        contact_keyboard = [
            [InlineKeyboardButton("üì∑ Instagram –ú–∞–π—Å—Ç—Ä–∞", url=INSTAGRAM_LINK)],
            back_to_menu_button[0]
        ]
        reply_markup = InlineKeyboardMarkup(contact_keyboard)
        await query.edit_message_text(text=contact_text, reply_markup=reply_markup, parse_mode='Markdown')

# ----------------------------------------------------
# --- –ì–û–õ–û–í–ù–ê –ê–°–ò–ù–•–†–û–ù–ù–ê –§–£–ù–ö–¶–Ü–Ø –ó–ê–ü–£–°–ö–£ ---
# ----------------------------------------------------

async def main() -> None:
    """–ó–∞–ø—É—Å–∫–∞—î –±–æ—Ç–∞ –≤ —Ä–µ–∂–∏–º—ñ Webhook. –ó–∞–≤–µ—Ä—à—É—î —Ä–æ–±–æ—Ç—É, —è–∫—â–æ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ TOKEN –∞–±–æ URL."""
    
    if not TOKEN:
        logger.critical("–ö–†–ò–¢–ò–ß–ù–ê –ü–û–ú–ò–õ–ö–ê: –ù–µ –≤–¥–∞–ª–æ—Å—è –∑–Ω–∞–π—Ç–∏ Telegram TOKEN (–ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ BOT_TOKEN).")
        sys.exit(1)
        
    if not WEBHOOK_URL:
        logger.critical("–ö–†–ò–¢–ò–ß–ù–ê –ü–û–ú–ò–õ–ö–ê: –ù–µ –≤–¥–∞–ª–æ—Å—è –∑–Ω–∞–π—Ç–∏ WEBHOOK_URL. –ù–µ–º–æ–∂–ª–∏–≤–æ –∑–∞–ø—É—Å—Ç–∏—Ç–∏ –≤ —Ä–µ–∂–∏–º—ñ Webhook –Ω–∞ Render.")
        logger.info("–î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ —Ä–µ–∂–∏–º Long Polling, –∞–ª–µ –¥–ª—è Render Webhook URL –æ–±–æ–≤'—è–∑–∫–æ–≤–∏–π.")
        sys.exit(1)


    application = Application.builder().token(TOKEN).build()
    
    # –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è –≤—Å—ñ—Ö –æ–±—Ä–æ–±–Ω–∏–∫—ñ–≤
    application.add_handler(CommandHandler("start", start_command))
    application.add_handler(CommandHandler("help", help_command))
    application.add_handler(CallbackQueryHandler(button_handler)) # –û–±—Ä–æ–±–Ω–∏–∫ –¥–ª—è –≤—Å—ñ—Ö inline-–∫–Ω–æ–ø–æ–∫
    # –û–±—Ä–æ–±–Ω–∏–∫ –¥–ª—è –±—É–¥—å-—è–∫–æ–≥–æ —Ç–µ–∫—Å—Ç—É, —è–∫–∏–π –Ω–µ —î –∫–æ–º–∞–Ω–¥–æ—é –∞–±–æ –∫–Ω–æ–ø–∫–æ—é
    application.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND, unknown_message))
    
    # --- –†–µ–∂–∏–º Webhook (–¥–ª—è –¥–µ–ø–ª–æ—é –Ω–∞ Render) ---
    full_webhook_url = f"{WEBHOOK_URL}{WEBHOOK_PATH}"

    # –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ Webhook
    logger.info(f"–í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è Webhook: {full_webhook_url}")
    await application.bot.set_webhook(
        url=full_webhook_url,
        drop_pending_updates=True # –í–∏–∫–∏–¥–∞—î–º–æ —Å—Ç–∞—Ä—ñ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è
    )

    # –ó–∞–ø—É—Å–∫–∞—î–º–æ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä
    logger.info(f"–ó–∞–ø—É—Å–∫ Webhook-—Å–µ—Ä–≤–µ—Ä–∞ –Ω–∞ 0.0.0.0:{PORT} –∑ —à–ª—è—Ö–æ–º {WEBHOOK_PATH}")
    await application.run_webhook(
        listen="0.0.0.0",
        port=PORT,
        url_path=WEBHOOK_PATH
    )
    
    # –ó–∞–±–µ–∑–ø–µ—á—É—î–º–æ, —â–æ –ø—Ä–æ—Ü–µ—Å Python –Ω–µ –∑–∞–≤–µ—Ä—à–∏—Ç—å—Å—è, –æ—á—ñ–∫—É—é—á–∏ Webhook-–∑–∞–ø–∏—Ç—ñ–≤
    while True:
        await asyncio.sleep(60) # –ü—Ä–æ—Å—Ç–æ —Ç—Ä–∏–º–∞—î–º–æ –ø—Ä–æ—Ü–µ—Å –∞–∫—Ç–∏–≤–Ω–∏–º


if __name__ == "__main__":
    try:
        # –ó–∞–ø—É—Å–∫ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—ó —Ñ—É–Ω–∫—Ü—ñ—ó main
        asyncio.run(main())
    except Exception as e:
        logger.critical(f"–ö—Ä–∏—Ç–∏—á–Ω–∞ –ø–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫—É: {e}")
        sys.exit(1)
